struct Solution;
const MOD: u64 = 1e9 as u64 + 7;
use std::collections::HashSet;
impl Solution {
    #[allow(dead_code)]
    pub fn maximize_square_area(
        m: i32,
        n: i32,
        mut h_fences: Vec<i32>,
        mut v_fences: Vec<i32>,
    ) -> i32 {
        if m == n {
            return Self::get_field((m - 1) as u64);
        }
        h_fences.sort_unstable();
        h_fences.push(m);
        h_fences.push(1);
        h_fences.rotate_right(1);
        v_fences.sort_unstable();
        v_fences.push(n);
        v_fences.push(1);
        v_fences.rotate_right(1);
        let h_fences_set = Self::collect_range(&h_fences);
        let mut width: u64 = 0;
        for (idx, val) in v_fences.iter().enumerate() {
            for right_val in v_fences[idx + 1..].iter() {
                let v = right_val - val;
                if h_fences_set.contains(&v) {
                    width = width.max(v as u64);
                }
            }
        }
        if width == 0 {
            -1
        } else {
            Self::get_field(width)
        }
    }
    fn collect_range(fences: &[i32]) -> HashSet<i32> {
        let mut fences_set = HashSet::<i32>::new();
        for (idx, val) in fences.iter().enumerate() {
            for right_val in fences[idx + 1..].iter() {
                fences_set.insert((right_val - val).abs());
            }
        }
        fences_set
    }

    fn get_field(n: u64) -> i32 {
        ((n * n) % MOD) as i32
    }
}

#[cfg(test)]
mod test_super {
    use super::*;

    #[test]
    fn test_1() {
        let m = 4;
        let n = 3;
        let h = vec![2, 3];
        let v = vec![2];
        assert_eq!(4, Solution::maximize_square_area(m, n, h, v));
    }
    #[test]
    fn test_2() {
        let m = 6;
        let n = 7;
        let h = vec![2];
        let v = vec![4];
        assert_eq!(-1, Solution::maximize_square_area(m, n, h, v));
    }
    #[test]
    fn test_3() {
        let m = 3;
        let n = 9;
        let h = vec![2];
        let v = vec![8, 6, 5, 4];
        assert_eq!(4, Solution::maximize_square_area(m, n, h, v));
    }
    #[test]
    fn test_4() {
        let m = 166118949;
        let n = 616808662;
        let h = vec![
            141081425, 98635777, 54408142, 136821612, 127484783, 45455338, 31356057, 83566472,
            57484842, 23583173, 116158661, 90386538, 122878964, 131188212, 80628228, 103201125,
            132644262, 147738908, 136906501, 26463582, 3898059, 93895162, 134308697, 155786894,
            68438576, 37700554, 124685802, 151860530, 7931802, 54615059, 55944633, 99155092,
            49330673, 84313847, 70654446, 17819461, 76428337, 154914346, 46125724, 42819899,
            79288760, 158002211, 45471721, 73033260, 63108803, 132047564, 7282048, 177838,
            40873366, 26060268, 164681462, 101805546, 164858071, 73886979, 19017662, 21717076,
            141535928, 37107141, 95905344, 160136641, 101382965, 109549804, 155516647, 128120399,
            153206718, 131347608, 106592115, 112143551, 144711312, 136873705, 50315545, 157465031,
            163085166, 144876320, 123149421, 150454748, 121517011, 97380079, 78322737, 152655137,
            131335951, 66727465, 120564986, 20504685, 45929544, 35532054, 132459392, 85252692,
            131663924, 124942584, 36258146, 152486559, 76615068, 58436576, 161371231, 136256902,
            135416686, 44977708, 150482581, 46001901, 99289542, 13922285, 103417779, 87675021,
            68308463, 23886123, 71937076, 44327398, 67349569, 153499107, 55316263, 48831882,
            112304573, 73852194, 82549598, 84504040, 118728553, 70611895, 59577910, 24382254,
            86686381, 102573871, 68296038, 87022653, 72742478, 101179694, 127734102, 86437520,
            100790601, 158260076, 143610189, 7260931, 91699674, 67274897, 158916002, 87665796,
            159064204, 22183406, 24315616, 77398854, 28373081, 142405822, 83830873, 124964411,
            24237032, 119220982, 163827384, 105247558, 93268424, 24395848, 80932, 19494967,
            30093746, 92114248, 140994879, 38932638, 140771360, 101073470, 68119402, 55265873,
            81414328, 108303788, 24945804, 59771576, 93406675, 97969262, 112901429, 105066572,
            4961526, 47951406, 77422770, 137461267, 138455436, 150663474, 110677237, 17602411,
            133045025, 140026476, 32568684, 57113360, 97377155, 52745659, 107702519, 95039571,
            45170964, 2704206, 77515831, 117844039, 14650135, 128266702, 71955277, 73908802,
            55036152, 112457904, 80023651, 7704392, 37556336, 64354822, 46466865, 14987520,
            104457360, 148325224, 99927697, 98512889, 63359659, 124561399, 33948958, 105728937,
            64654905, 16877250, 98577970, 159400272, 644584, 155426713, 17158924, 55877484,
            41050794, 149564553, 73915028, 146367531, 114863634, 14225311, 105436015, 92533322,
            88292254, 54926424, 59287378, 139114550, 32600390, 62627555, 118816865, 55512282,
            124522593, 146348367, 126924339, 51160382, 14711484, 130729965, 9630904, 74887384,
            17318086, 63335855, 4907194, 89233423, 101769390, 110554620, 121700205, 12357993,
            137482961, 155907611, 101211501, 139068795, 72629020, 140788579, 78824947, 58775314,
            74771743, 87665896, 12100887, 163335101, 32330891, 111626890, 74048243, 2905132,
            40691972, 36945233, 101284450, 4683707, 69801678, 147479419, 108748153, 48534106,
            118795937, 5358264, 15570486, 27143428, 162655172, 162631776, 24632644, 19701973,
            147016677, 127105130, 48898449, 154035763, 48737385, 73928271, 119714459, 92827956,
            61825811, 63268, 81322948, 111119325, 95149039, 149515256, 80926772, 157085912,
            77011079, 138943742, 112760336, 129036900, 114185897, 52146854, 144121496, 151637602,
            32866284, 152085848, 95825297, 286872, 135120281, 137116342, 163044394, 147755349,
            21407288, 76008470, 14298349, 134780788, 61368792, 156437017, 63319708, 102216859,
            92262419, 74255075, 108112024, 72983524, 26414114, 136109455, 41175729, 135848683,
            121997430, 7624112, 11839992, 135330044, 145699590, 90471496, 89991593, 120539168,
            138253783, 121473381, 3785196, 128862927, 120848551, 131764562, 74271991, 21816205,
            120689658, 145042986, 94650521, 49078683, 62269485, 20672054, 117161898, 7509873,
            103984324, 123261315, 110969001, 142751541, 20943278, 9105841, 37887142, 136822955,
            39963083, 5102301, 19903808, 165851060, 98099533, 91635029, 52928081, 81951790,
            10483978, 21138763, 17612601, 156251041, 162164527, 15953252, 93630647, 115574542,
            12981253, 61741518, 116899818, 163128519, 90512929, 94697538, 37536779, 161069022,
            61842763, 63430732, 17877384, 29598909, 37366080, 27773287, 47602322, 89298725,
            50223165, 149520074, 63198304, 122428731, 120118314, 72512782, 50057793, 119654425,
            61777094, 137567574, 51751061, 130845478, 46545572, 41849429, 163842765, 4163320,
            164097271, 146608510, 81434181, 163461667, 73197215, 155190503, 86851278, 63725348,
            59368944, 149315573, 65266932, 33548781, 36031119, 66896139, 9780642, 134120669,
            19149226, 85357151, 54123454, 89165956, 31493062, 125424054, 102149686, 42042558,
            143674388, 51723967, 43335982, 112279288, 20852342, 36718627, 24612944, 127396261,
            31055196, 1257271, 144729518, 160659919, 57828367, 127568425, 25108796, 92596971,
            62108569, 10570698, 76665542, 2181163, 2479372, 107427467, 57941515, 1727099,
            143414712, 138639242, 107469030, 85714484, 100444743, 74193745, 124295958, 86832672,
            101690930, 23453358, 108773589, 46630182, 18563064, 64501034, 49410889, 117604215,
            166095458, 76634012, 117376133, 14765199, 16892977, 72724894, 117062962, 48434481,
            97297601, 133630211, 89301267, 68751651, 26464195, 150317134, 136135580, 61355431,
            146843095, 35126896, 145583864, 138127660, 75072094, 163322673, 85145540, 92042175,
            36990967, 58640503, 103059818, 52351159, 147300113, 138711950, 121296497, 138495883,
            68966667, 165113045, 36366170, 129963213, 64412022, 80751442, 11696647, 50520063,
            82804119, 130566819, 59650565, 10585450, 10130390, 87310765, 6290176, 82271893,
            31955082, 14736311, 76605449, 44899712, 36673735, 41044625, 61092309, 98718786,
            33198860, 61621917, 96142685, 144456205, 118632367, 97006892, 116241050, 150150181,
            165197687, 138982789, 68419892, 26534910, 34365961, 112796810, 152094957, 148359451,
            19447413, 23428181, 35270461, 138570011, 89956685, 42791404, 124473864, 64323959,
            27604414, 60209680, 14544921, 37712677, 126865609, 61065372, 163839436, 16927080,
            29809006, 33495030, 110488399, 42010312, 36902500, 93640206, 41706027, 89747030,
            100174337, 114358581, 68904449, 30295389, 56447652, 44913177, 96682031, 812375,
            85447169, 76993664, 161835822, 161061545, 151469926, 137906225, 79104157, 90131018,
            119097482, 134000473, 111186411, 107622410, 67341852, 148473273, 22206333, 120968853,
            62994795, 47792537, 102259948, 45395300, 79641345, 90294518, 29097176, 30765853,
        ];
        let v = vec![
            569109184, 377620169, 487873976, 2240032, 583763896, 282753216, 404862769, 284040443,
            517256607, 177799027, 158737003, 190014992, 2146334, 44811012, 584471706, 525497261,
            431864703, 27396729, 397799812, 506236985, 569412507, 205745308, 572811065, 544725608,
            419661860, 491950956, 373142381, 113515749, 287493772, 372853951, 262717688, 275634268,
            426226349, 365614373, 297268887, 259666689, 74871024, 136163279, 519098599, 164917995,
            359535568, 38792841, 81341055, 232613930, 24436547, 576055332, 13383671, 285452898,
            44860096, 547919205, 231752542, 414952091, 454131558, 165165445, 513212190, 216632207,
            181620173, 216775149, 120607636, 474232110, 219189985, 104953138, 463053225, 39332406,
            257234225, 429880282, 559276350, 442303436, 288281976, 282411406, 323692642, 208716708,
            291333175, 294491889, 53889655, 330051546, 72198960, 572995676, 176013765, 197511335,
            524740576, 251827715, 472417312, 388483166, 438856983, 87672559, 570973076, 345682182,
            237423908, 260964356, 526381069, 238233668, 537615571, 574303655, 306248106, 541322889,
            604543530, 182214650, 453238065, 120732115, 317329075, 493307590, 88931439, 204487366,
            407214962, 235707336, 301351106, 586107633, 8564911, 471551692, 332607343, 579352112,
            486332454, 404909738, 223205865, 468386291, 351352179, 111609487, 184169147, 277070964,
            583184633, 269547841, 540340125, 45212531, 279276651, 413898896, 432424567, 120713112,
            460625298, 78122119, 231578756, 491207801, 235335691, 445618654, 554119554, 431481907,
            371977651, 212043698, 69992718, 346391127, 44770893, 574412383, 533922069, 559186922,
            605508581, 557548551, 558383572, 122211598, 411143737, 74784258, 307217112, 371282733,
            375311252, 547173409, 56961871, 382147872, 252278448, 310792399, 341187131, 255489962,
            428263684, 400463773, 312073971, 63028752, 253320997, 330062759, 262358853, 236885275,
            428596164, 473945047, 562680762, 404245642, 312810428, 586720301, 132272227, 344939158,
            21643113, 41102042, 529033663, 605149809, 120637032, 229869001, 440364290, 433053894,
            66491467, 22977026, 111282151, 246670101, 397195883, 342217465, 64935206, 160263564,
            554779921, 227586415, 605054423, 187031777, 445950192, 518896200, 55050800, 127632989,
            59653222, 195871734, 315638463, 159939714, 242252770, 297673922, 385398221, 463868595,
            423263066, 615699930, 424069304, 254745651, 269374737, 497016625, 371421404, 615799911,
            579341350, 398877411, 233651877, 151771484, 45477453, 478261769, 430092858, 489324806,
            569659557, 518106588, 536876423, 89355226, 300618824, 186031368, 93185012, 313139333,
            372500595, 246111721, 110318324, 128250799, 290202272, 368691331, 343238089, 597643473,
            62057665, 615649882, 174280428, 446599682, 148088674, 395005765, 472350250, 140917787,
            146291900, 8751876, 20715684, 11395648, 123602909, 357114642, 114964331, 527025417,
            133957435, 445767640, 255476998, 113269313, 330512623, 25350842, 367799996, 364527609,
            85701074, 513185525, 43561410, 255717895, 439377050, 365344031, 135482957, 292833142,
            376578636, 582993530, 46290495, 325186486, 258791658, 50288029, 601639532, 598808504,
            92986650, 531279871, 379967171, 54745860, 538174843, 582308824, 357483279, 519474679,
            64589040, 99975055, 269772862, 346228867, 475597754, 286331370, 514200640, 195509275,
            389322438, 126203428, 179220821, 545420669, 481800125, 76049283, 26514335, 134923247,
            49621335, 52605570, 274108482, 364708200, 394696713, 381550518, 96639277, 558862568,
            42219086, 290873593, 1812915, 454611199, 463967853, 71079365, 514835914, 48521790,
            22302869, 278948967, 37811487, 58788401, 25950025, 605458983, 458402613, 91723173,
            82700825, 191668976, 449764661, 11989946, 65895142, 4414988, 610314953, 246711170,
            311861699, 336820200, 157980149, 590967419, 434301926, 565328089, 505567009, 546005981,
            329525545, 241392198, 139355150, 199232709, 140452495, 545269983, 445046927, 163879390,
            356967677, 432089635, 334164083, 538372585, 164017915, 476094560, 541537271, 74412043,
            210234264, 517329866, 221328052, 572807499, 113096802, 176434291, 608695037, 258775503,
            502263164, 286190382, 543486499, 589280577, 588368601, 516118549, 420840660, 326347151,
            543535876, 464416755, 462119675, 447359166, 112240930, 101963388, 127300769, 120830937,
            570998878, 226794329, 306076186, 599576360, 292519422, 193919777, 406631097, 380217407,
            408163828, 432110253, 514469617, 332073478, 237888861, 432052440, 519469830, 235733296,
            36802166, 215984037, 219520278, 280056943, 33222655, 257001621, 1353599, 585957233,
            366025454, 263063984, 605312569, 130383107, 472989756, 37102061, 113910333, 547067900,
            423843956, 247469001, 489300776, 580692077, 428584405, 543390496, 49856386, 568464758,
            177737025, 511798679, 131457643, 334624150, 95245007, 134330871, 5002722, 461556830,
            374705056, 538150851, 40209072, 524880154, 191320967, 36289440, 221712594, 598111401,
            513869233, 122595735, 96155806, 563547779, 448232869, 147316700, 458525686, 122293063,
            6239461, 321377696, 312218027, 252396163, 264350596, 471388300, 25390926, 177630895,
            355534620, 557486125, 446018872, 141775983, 280851600, 239160668, 103594702, 232448543,
            364517737, 592829302, 201721669, 409696543, 244335912, 14027430, 252194978, 450046048,
            456628809, 304693050, 358433438, 217724299, 120162949, 226520338, 475698811, 601093227,
            82068926, 489501237, 83815783, 314527580, 18565433, 363369077, 177803003, 605448562,
            281850191, 613154698, 71517568, 114361473, 409859689, 261923259, 322950635, 136704169,
            551919545, 386395303, 434590498, 123081954, 357677986, 206058040, 438488318, 150738702,
            135619807, 298917360, 428250702, 83532593, 358555458, 246429926, 277409429, 392251190,
            103918624, 561920664, 282332448, 76960140, 391191630, 502747317, 511163189, 71900626,
            69737812, 65383181, 49366883, 47259106, 373003763, 210283661, 205307707, 452562432,
            409410353, 378331661, 571114416, 250337963, 210807117, 602179375, 64538295, 591568658,
            593876117, 520449760, 474389187, 418138886, 280558853, 78241369, 605176382, 465862546,
            305264979, 336006205, 564656489, 308202186, 120216584, 387847611, 592606377, 190574784,
            289000429, 514198254, 267879634, 424787260, 1630027, 398975383, 274776141, 543745366,
            123558226, 504874870, 205897553, 230728844, 274734842, 499775570, 481929710, 342806027,
            379719234, 33034403, 463129561, 331307563, 555476726, 188256527, 427053952, 293200762,
            44176168, 471118444, 543906352, 122764730, 237491350, 34616632, 39203184, 287852195,
            234391450, 328657692, 413816407, 257538745, 204519784, 87299462, 65289540, 253433120,
            505079737, 459519359, 454294777, 556534691, 69341985, 62758224, 291589564, 6084424,
        ];
        assert_eq!(122376308, Solution::maximize_square_area(m, n, h, v));
    }
}
